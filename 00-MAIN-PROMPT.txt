================================================================================
KSAA STEMCARE PATIENT MANAGEMENT SYSTEM - MAIN BUILD PROMPT
================================================================================

OBJECTIVE:
Build a fully functional patient management system for STEMCARE clinic with:
- Patient portal for booking appointments and managing profile
- Super admin dashboard for managing patients, products, appointments, and schedules
- Manual notification system (email & WhatsApp queues)
- Stripe payment integration with deposit options
- Google Calendar integration
- Real-time quota management system

TARGET: Malaysian market, deployed on Vercel

================================================================================
BUILD REQUIREMENTS
================================================================================

YOU MUST BUILD A COMPLETE, WORKING SYSTEM WITH:

1. AUTHENTICATION SYSTEM
   - Patient registration and login (NextAuth.js)
   - Super admin login
   - Role-based access control
   - Session management
   - Password reset functionality

2. PATIENT PORTAL (Fully Functional)
   - Complete registration flow
   - Profile management with medical history
   - Browse available STEMCARE products
   - Book appointments (4-step flow)
   - Stripe payment integration (full or deposit)
   - View appointment history
   - Request cancellation/refunds

3. SUPER ADMIN DASHBOARD (Fully Functional)
   - Patient management (view, search, export)
   - Product CRUD operations
   - Weekly schedule builder with flexible time slots
   - Date overrides for holidays/closures
   - Appointment management (view, edit, cancel)
   - Manual notification queues (email & WhatsApp)
   - Payment tracking and refund processing
   - Google Calendar integration
   - Real-time analytics

4. SCHEDULING SYSTEM
   - Flexible time slots per day
   - Service-specific quota management
   - Real-time availability tracking
   - Prevent overbooking
   - Calendar view with color-coded availability

5. PAYMENT SYSTEM
   - Stripe integration (MYR currency)
   - Full payment option (100%)
   - Deposit payment option (30-50% configurable)
   - Balance tracking for deposits
   - Admin can mark balance as paid
   - Refund request and processing system

6. NOTIFICATION SYSTEM (Manual - No API costs)
   - Email queue for 24h reminders
   - WhatsApp queue for 24h reminders
   - Pre-formatted message templates
   - Copy-to-clipboard functionality
   - Mark as sent tracking

7. GOOGLE CALENDAR INTEGRATION
   - OAuth connection setup
   - Auto-sync appointments
   - Create/update/delete calendar events
   - Include patient details in events

================================================================================
TECHNICAL STACK (MUST USE)
================================================================================

- Framework: Next.js 14+ (App Router)
- Database: Vercel Postgres or Supabase (use Prisma ORM)
- Authentication: NextAuth.js v5
- Payments: Stripe (Malaysian market setup)
- Styling: Tailwind CSS + shadcn/ui components
- Calendar: Google Calendar API
- Deployment: Vercel
- Language: TypeScript

================================================================================
DATABASE SCHEMA (IMPLEMENT EXACTLY)
================================================================================

Refer to: 01-DATABASE-SCHEMA.txt

You MUST implement all tables with proper relationships, indexes, and constraints.

================================================================================
FEATURE IMPLEMENTATION DETAILS
================================================================================

Refer to these files for detailed specifications:
- 02-PATIENT-PORTAL-FEATURES.txt
- 03-ADMIN-DASHBOARD-FEATURES.txt
- 04-SCHEDULING-SYSTEM.txt
- 05-PAYMENT-SYSTEM.txt
- 06-NOTIFICATION-SYSTEM.txt
- 07-GOOGLE-CALENDAR-INTEGRATION.txt

================================================================================
UI/UX REQUIREMENTS
================================================================================

Refer to: 08-UI-DESIGN-GUIDELINES.txt

CRITICAL: The system must be:
- Mobile-first responsive
- Clean and professional design
- Fast and performant
- Accessible (WCAG 2.1 AA)

================================================================================
DEVELOPMENT APPROACH
================================================================================

BUILD IN THIS ORDER:

PHASE 1 - FOUNDATION:
1. Initialize Next.js project with TypeScript
2. Setup Prisma with database schema
3. Implement NextAuth.js authentication
4. Setup basic UI components (shadcn/ui)
5. Create basic layouts and navigation

PHASE 2 - PATIENT FEATURES:
1. Patient registration and login flows
2. Patient profile CRUD with medical history
3. Product listing page
4. Basic appointment calendar view

PHASE 3 - ADMIN CORE:
1. Admin login and dashboard
2. Product management (CRUD)
3. Weekly schedule builder
4. Date override system

PHASE 4 - BOOKING & PAYMENT:
1. 4-step booking flow
2. Stripe checkout integration
3. Payment confirmation
4. Quota tracking system
5. Appointment creation

PHASE 5 - ADMIN OPERATIONS:
1. Patient management interface
2. Appointment management
3. Email notification queue
4. WhatsApp notification queue
5. Payment and balance tracking

PHASE 6 - ADVANCED FEATURES:
1. Google Calendar OAuth setup
2. Calendar sync functionality
3. Refund request system
4. Admin refund processing
5. Analytics dashboard

PHASE 7 - POLISH & TESTING:
1. Error handling throughout
2. Loading states and optimistic updates
3. Form validation
4. Security audit
5. Performance optimization
6. Responsive design fixes

================================================================================
CRITICAL REQUIREMENTS FOR FUNCTIONALITY
================================================================================

1. ALL CRUD OPERATIONS MUST WORK:
   - Create, Read, Update, Delete for all entities
   - Proper error handling
   - Success/error notifications

2. BOOKING FLOW MUST BE COMPLETE:
   - Step 1: Select service
   - Step 2: Choose date & time (check availability)
   - Step 3: Review and pay (Stripe)
   - Step 4: Confirmation (create appointment + calendar event)

3. QUOTA SYSTEM MUST PREVENT OVERBOOKING:
   - Real-time checking before payment
   - Lock quota during payment process
   - Release if payment fails

4. PAYMENTS MUST BE SECURE:
   - Stripe Elements for card input
   - Webhook handling for payment confirmation
   - Proper error handling for failed payments

5. CALENDAR SYNC MUST BE BIDIRECTIONAL:
   - New appointment â†’ Create event
   - Cancel appointment â†’ Delete event
   - Update appointment â†’ Update event

6. ADMIN MUST HAVE FULL CONTROL:
   - View all data
   - Manage all entities
   - Override system rules when needed
   - Export data

7. REAL-TIME UPDATES WHERE NEEDED:
   - Quota availability
   - Appointment status
   - Payment status

================================================================================
SECURITY REQUIREMENTS
================================================================================

1. Authentication:
   - Secure password hashing (bcrypt)
   - Protected routes (middleware)
   - Session management

2. Authorization:
   - Role-based access control
   - Admin-only routes protected
   - API route protection

3. Payment:
   - Never store card details
   - Use Stripe Elements
   - Validate webhook signatures

4. Data:
   - Sanitize all inputs
   - Prevent SQL injection (use Prisma)
   - XSS protection

================================================================================
ENVIRONMENT SETUP
================================================================================

Refer to: 09-ENVIRONMENT-SETUP.txt

You must configure all environment variables correctly.

================================================================================
DEPLOYMENT CHECKLIST
================================================================================

Before considering the project complete, ensure:

[ ] All authentication flows work
[ ] Patient can register and create profile
[ ] Patient can book appointment and pay
[ ] Admin can login and access dashboard
[ ] Admin can manage products
[ ] Admin can set schedule
[ ] Admin can view appointments
[ ] Admin can send notifications (manual queues)
[ ] Stripe payments work in test mode
[ ] Google Calendar sync works
[ ] Refund system works
[ ] All pages are responsive
[ ] No console errors
[ ] Loading states implemented
[ ] Error handling implemented
[ ] Deployed to Vercel successfully
[ ] All environment variables set

================================================================================
WHAT "FULLY FUNCTIONAL" MEANS
================================================================================

Every feature must:
1. Work end-to-end without errors
2. Have proper validation
3. Show loading states
4. Handle errors gracefully
5. Provide user feedback
6. Work on mobile and desktop
7. Be secure and follow best practices

If a button exists, it must do something.
If a form exists, it must submit and save data.
If a page exists, it must display real data.

NO PLACEHOLDER OR DEMO DATA IN FINAL BUILD.

================================================================================
FILE STRUCTURE TO IMPLEMENT
================================================================================

Refer to: 10-FILE-STRUCTURE.txt

Follow this exact structure for organization.

================================================================================
TESTING REQUIREMENTS
================================================================================

You must test:
1. Each authentication flow (patient, admin)
2. Complete booking flow (start to finish)
3. Payment flow (full and deposit)
4. Quota system (prevent overbooking)
5. Calendar sync (create, update, delete)
6. Admin CRUD operations
7. Responsive design on mobile

================================================================================
FINAL DELIVERABLES
================================================================================

1. Complete, working Next.js application
2. Database migrations (Prisma)
3. Environment variables template (.env.example)
4. README.md with setup instructions
5. Deployment guide
6. Admin user creation script
7. Test data seeding script (optional)

================================================================================
SUCCESS CRITERIA
================================================================================

The project is ONLY complete when:

âœ“ A patient can register, login, book appointment, and pay
âœ“ Admin can login and manage everything
âœ“ Payments process successfully via Stripe
âœ“ Calendar events sync to Google Calendar
âœ“ Quota system prevents overbooking
âœ“ All pages are responsive and error-free
âœ“ System is deployed and accessible on Vercel
âœ“ All environment variables are documented
âœ“ Setup instructions are clear

================================================================================
IMPORTANT NOTES
================================================================================

- Use TypeScript for type safety
- Follow Next.js 14 App Router conventions
- Use Server Actions where appropriate
- Implement proper error boundaries
- Use React Server Components by default
- Client components only when needed
- Optimize images with next/image
- Use proper SEO meta tags
- Implement proper loading states
- Add toast notifications for user feedback

================================================================================
QUESTIONS TO RESOLVE DURING BUILD
================================================================================

If you encounter ambiguity:
1. Deposit percentage: Use 30% as default (configurable per product)
2. Time zone: Use UTC, display in Malaysian time (GMT+8)
3. Date format: Use DD/MM/YYYY for Malaysian market
4. Currency: MYR (Malaysian Ringgit)
5. Phone format: Malaysia format (+60)

================================================================================
START BUILDING NOW
================================================================================

Begin with Phase 1 and work through each phase systematically.
Build complete features before moving to next phase.
Test each feature as you build it.

Read all supplementary files for detailed specifications.

This is a PRODUCTION system, not a prototype. 
Every feature must work perfectly.

LET'S BUILD THIS! ðŸš€
